<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Easy Website Screenshots</title>

     <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-touch-fullscreen" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta content="" name="description" />
    <meta content="" name="author" />
    <link href="css/bootstrap.min.css" rel="stylesheet" type="text/css" />
    <script type="text/javascript" src="js/jquery-3.2.1.min.js" ></script>
    <script type="text/javascript" src="js/jquery-us.js" ></script>

       <style type="text/css">
        @font-face {  font-family: 'aBold';src: url('fonts/Avance/Avance Bold.ttf'); }
        @font-face {  font-family: 'aRegular';src: url('fonts/Avance/Avance Regular.ttf'); }
        @font-face {  font-family: 'aItalic';src: url('fonts/Avance/Avance Regular Italic.otf'); }
        .fadeinLogo{
          opacity: 0.8;
        }
        </style>
	  <script type="text/javascript" src="cordova.js"></script>
	</head>

    <body style="overflow-x:hidden;background-color: rgba(232,233,234,0.7);">

       <div id="contentStep" style="display: none;position:absolute;left:0px;top:0px;height:100%;width:100%;">

                    <div id="header" style="position:relative;left:0px;top:0px;width:100%;padding-bottom:15px;padding-top:5px;">
                       <table width="100%" style="margin-top:25px;">
                            <tbody><tr>
                               <td width="10%" align="left" valign="center"></td>
                                    <td width="55%" align="left" valign="center">
                    <label style="color:#6B5A5F;font-size:25px;font-family:aBold;line-height:0.9;">Easy ScreenShots <br> <span style="color:#95A3CF;font-size:23px;font-family:aBold;">Websites</span></label>

                                </td>
                                    <td width="20%" align="right" valign="bottom">
                                        <img src="icon.png" width="60" onclick="saveFile2();">
                                    </td>
                                    <td width="10%" align="left" valign="center"></td>
                            </tr>

                        </tbody></table>


                    </div>
                    <div style="display:none;position:absolute;left:0px;top:20%;height:80%;width:100%;" align="center" id="fourStep" align="center">

                      <table width="80%" height="">
                  				<tr>
                  						<td valign="center" width="50%">
                                  <label style="color:#6B5A5F;font-size:23px;font-family:aItalic;">
                                    Width in px
                                  </label>
                                  <input class="form-control" id="width" value="1200" type="number">
                              </td>
                            </tr>
                            <tr>
                              <td>
                                  <label style="color:#6B5A5F;font-size:23px;font-family:aItalic;" onclick="alert($(this).attr('text'))" text="Is your height of page, if value is 0 the image is fullscreen">
                                    Height in px <span style="color:#95A3CF;">(?)</span>
                                  </label>
                                  <input class="form-control" id="height" value="0" type="number">

                  							</td>
                  				</tr>
                          <tr>
                  						<td valign="center"  width="50%">
                                  <label style="color:#6B5A5F;font-size:23px;font-family:aItalic;" onclick="alert($(this).attr('text'))" text="Specifies the timeout while the page loads, value 0 seconds is default">
                                    Wait in sec <span style="color:#95A3CF;">(?)</span>
                                  </label>
                                  <input class="form-control" id="wait" placeholder="0" type="number">
                              </td>
                            </tr>
                            <tr>
                              <td>
                                  <label style="color:#6B5A5F;font-size:23px;font-family:aItalic;" onclick="alert($(this).attr('text'))" text="select your image quality if the quality is higher, your file size will be bigger">
                                    Quality <span style="color:#95A3CF;">(?)</span>
                                  </label>
                                  <select class="form-control" id="sQuality">
                                    <option value="20">Low</option>
                                    <option value="40">Medium</option>
                                    <option value="60">Hight</option>
                                    <option value="80" selected>Very High</option>
                                    <option value="100">Maximum</option>
                                  </div>

                  							</td>
                  				</tr>
                          <tr>
                  						<td valign="center"  width="50%">
                                  <label onclick="alert($(this).attr('text'))" text="Send Paramteres to website via GET request with this especific format: param1=onecontent;param2=secondcontent;" style="color:#6B5A5F;font-size:23px;font-family:aItalic;">
                                    Headers <span style="color:#95A3CF;">(?)</span>
                                  </label>
                                  <input class="form-control" id="headers" placeholder="param1=one;param2=two" type="text">
                              </td>
                            </tr>
                            <tr>
                              <td>
                                  <label onclick="alert($(this).attr('text'))" text="Set Cookies to yo page with this format: cookie1=yourcookie;cookie2=yourcookie;" style="color:#6B5A5F;font-size:23px;font-family:aItalic;">
                                    Cookies <span style="color:#95A3CF;">(?)</span>
                                  </label>
                                  <input class="form-control" id="cookies" placeholder="cookie1=one;cookie2=two;" value="" type="text">

                  							</td>
                  				</tr>
                          <tr>
                            <td colspan="">
                              <div style="margin-top:15px;background-color: #95A3CF; width: 100%;height: 40px;padding:5px;cursor: pointer;" class="shadowButton" onclick="saveSettings();">
                                   <table width="100%" height="100%">
                                       <tr>
                                            <td valign="center" align="center">
                                                <label style="color:white;font-size:20px;font-family:aBold;line-height:0.9;cursor: pointer;">Save Settings
                                   </label>
                                            </td>
                                       </tr>
                                   </table>

                              </div>
                            </td>
                          </tr>

                          <tr>
                            <td colspan="">
                              <div style="margin-top:15px;background-color: #95A3CF; width: 100%;height: 40px;padding:5px;cursor: pointer;" class="shadowButton" onclick="step(1);defaultValues();">
                                   <table width="100%" height="100%">
                                       <tr>
                                            <td valign="center" align="center">
                                                <label style="color:white;font-size:20px;font-family:aBold;line-height:0.9;cursor: pointer;">Default Values
                                   </label>
                                            </td>
                                       </tr>
                                   </table>

                              </div>
                            </td>
                          </tr>

                  		</table>

                    </div>

                    <div style="display:none;position:relative;left:0px;top:0px;height:auto;width:100%;" align="center" id="thirdStep" align="center">
                      <table width="90%" height="">
                              <tr>
                                <td colspan="2" align="center">

                                  	<label style="color:#95A3CF;font-size:28px;font-family:aBold;line-height:0.8">
                                      Awesome!
                                      <br><span style="color:#6B5A5F;font-size:23px;font-family:aItalic;">Your picture has been captured successfully</span>
                                    </label>
                                    <br>
                                </td>
                              </tr>
                              <tr>
                                <td colspan="">
                                  <div style="margin-top:15px;background-color: #95A3CF; width: 100%;height: 40px;padding:5px;cursor: pointer;" class="shadowButton" onclick="saveScreenshot();">
                                       <table width="100%" height="100%">
                                           <tr>
                                                <td valign="center" align="center">
                                                    <label style="color:white;font-size:20px;font-family:aBold;line-height:0.9;cursor: pointer;">Save in Device
                                       </label>
                                                </td>
                                           </tr>
                                       </table>

                                  </div>
                                </td>
                                <td colspan="">
                                  <div style="margin-top:15px;background-color: #95A3CF; width: 100%;height: 40px;padding:5px;cursor: pointer;" class="shadowButton" onclick="shareScreenshot();">
                                       <table width="100%" height="100%">
                                           <tr>
                                                <td valign="center" align="center">
                                                    <label style="color:white;font-size:20px;font-family:aBold;line-height:0.9;cursor: pointer;">Share With
                                       </label>
                                                </td>
                                           </tr>
                                       </table>

                                  </div>
                                </td>
                              </tr>

                              <tr>
                                <td colspan="2">
                                  <div style="margin-top:10px;background-color: #95A3CF; width: 100%;height: 40px;padding:5px;cursor: pointer;" class="shadowButton" onclick="$('#domain').val('');step(0);defaultValues();">
                                       <table width="100%" height="100%">
                                           <tr>
                                                <td valign="center" align="center" >
                                                    <label style="color:white;font-size:20px;font-family:aBold;line-height:0.9;cursor: pointer;">Try Again
                                       </label>
                                                </td>
                                           </tr>
                                       </table>

                                  </div>
                                </td>

                              </tr>

                              <tr>
                                <td colspan="2" align="center">
                                  <br>
                                  <img src="https://www.tutorialspoint.com/videotutorials/images/tutor_connect_home.jpg" id="responseImage" width="100%" >

                                  <br>
                                </td>
                              </tr>
                      </table>
                    </div>
                    <div style="display:none;position:absolute;left:0px;top:20%;height:80%;width:100%;" align="center" id="fetching">

                      <table width="100%" height="70%">
                  				<tr>
                  						<td valign="center" align="center">

                                              <br><br>
                  								<img src="x400.png" class="fadeinLogo" width="200" >
                  								<br><br>
                  								<label style="color:#6B5A5F;font-size:23px;font-family:aItalic;">Fetching Image...</label>
                  							</td>
                  				</tr>
                  		</table>

                    </div>
                    <div style="display:none;position:absolute;left:0px;top:20%;height:80%;width:100%;" align="center" id="secondStep">

                      <table width="80%" height="70%">
                          <tr>
                                  <td valign="center" align="center">
                                      <div align="center"><label style="color:#6B5A5F;font-size:25px;font-family:aBold;line-height:0.9;"> ¿Are you sure take a screenshot this site?</label>
<br> <span style="color:#95A3CF;font-size:23px;font-family:aBold;" id="nameWebsite">www.google.com</span>
                                      </div>

                                    <div style="margin-top:15px;background-color: #95A3CF; width: 300px;height: 40px;padding:5px;cursor: pointer;" class="shadowButton" onclick="step(2);">
                                         <table width="100%" height="100%">
                                             <tr>
                                                  <td valign="center" align="center">
                                                      <label style="color:white;font-size:30px;font-family:aBold;line-height:0.9;cursor: pointer;">Take Screenshot
                                         </label>
                                                  </td>
                                             </tr>
                                         </table>

                                    </div>

                                    <div style="margin-top:15px;background-color: #95A3CF; width: 300px;height: 40px;padding:5px;cursor: pointer;" class="shadowButton" onclick="step(4);">
                                      <div style="position:relative;width:100%;display:none;" id="withChanges">
                                        <div style="position:absolute;right:-15px;top:-15px;background-color:red;border-radius:50%;width:30px;height:30px;" >
                                        </div>
                                      </div>
                                         <table width="100%" height="100%">
                                             <tr>
                                                  <td valign="center" align="center">
                                                      <label style="color:white;font-size:30px;font-family:aBold;line-height:0.9;cursor: pointer;">More Settings
                                         </label>
                                                  </td>
                                             </tr>
                                         </table>

                                    </div>
                                  </td>
                          </tr>

                      </table>

                    </div>
                    <div style="display:none;position:absolute;left:0px;top:20%;height:80%;width:100%;" align="center" id="firstStep">

                        <table width="80%" height="80%">
                            <tr>
                                    <td valign="center" align="center">
                                        <div align="left"><label style="color:#6B5A5F;font-size:20px;font-family:aRegular;line-height:0.9;cursor: pointer;"> Please write the name of website</label></div>
                                      <input id="domain" type="url" name="url" class="form-control" style="font-family:aRegular;text-align: center; height: 60px;font-size: 28px;text-transform: lowercase;" placeholder="www.mywebsite.com" >
                                      <div style="margin-top:15px;background-color: #95A3CF; width: 200px;height: 40px;padding:5px;cursor: pointer;margin-bottom:50px;" class="shadowButton" onclick='  step(1);'>
                                           <table width="100%" height="100%">

                                               <tr>
                                                    <td valign="center" align="center">
                                                        <label style="color:white;font-size:30px;font-family:aBold;line-height:0.9;cursor: pointer;">Next
                                           </label>
                                                    </td>
                                               </tr>
                                           </table>

                                      </div>
                                    </td>
                            </tr>

                        </table>
                    </div>

       </div>
    	<div style="position:absolute;left:0px;top:0px;height:100%;width:100%;" id="loadingPage">
    		<table width="100%" height="100%">
    				<tr>
    						<td valign="center" align="center">
                                <label Style="color:#6B5A5F;font-size:28px;font-family:aBold;line-height:0.8;">Easy ScreenShots</label>
                                <br>
                                <label Style="color:#95A3CF;font-size:33px;font-family:aBold;line-height:0.8;">Websites</label>
                                <br>
                                <label Style="color:#95A3CF;font-size:23px;font-family:aItalic;line-height:0.8;">Version 1.0</label>
                                <br><br>
    								<img src="x400.png" class="fadeinLogo" width="200">
    								<br><br>
    								<label Style="color:#6B5A5F;font-size:23px;font-family:aItalic;">Loading..</label>
    							</td>
    				</tr>
    		</table>
    	</div>

    <script>
    var cancelScreen=false;
    var full_page="true";
    var specialSettings=false;
    var strParams="&full_page=true&width=1200&response_type=image";

    document.addEventListener("backbutton", onBackKeyDown, false);

    function defaultValues(){
        $("#width").val("1200");
        $("#wait").val("0");
        $("#height").val("0");
        $("#sQuality option:selected").val(80);
        $("#headers").val("");
        $("#cookies").val("");
        specialSettings=false;
        strParams="&full_page=true&width=1200&response_type=image";
        $("#withChanges").css("display", "none");
    }
    function saveSettings(){
      width=$("#width").val();
      wait=$("#wait").val();
      height=$("#height").val();
      quality=$("#sQuality option:selected").val();
      headers=$("#headers").val();
      cookies=$("#cookies").val();
      var str1="";
      var str2="";
      if(height=="0"){
         full_page="true";
      }else{
        specialSettings=true;
           full_page="false";
      }

      if($.trim(headers)!=''){
        exp=$.trim(headers).split(";");
        if(exp.length){
          cont=0;
          str1="";
          for(var i=0;i < exp.length; i++){
              c=exp[i];
              if(c!=''){
                str1=str1+c+";";
              }
          }
          //alert(str1);
        }
          specialSettings=true;
      }

      if($.trim(cookies)!=''){
        exp2=$.trim(cookies).split(";");
        if(exp2.length){
          cont2=0;
          str2="";
          for(var i=0;i < exp2.length; i++){
              c=exp2[i];
              if(c!=''){
                str2=str2+c+";";
              }
          }
          //alert(str2);
        }
          specialSettings=true;

      }

      if(specialSettings){
        $("#withChanges").fadeIn();
          strParams="&height="+height+"&width="+width+"&full_page="+full_page+"&wait_for="+wait+"&quality="+quality+"&headers="+str1+"&cookies="+str2+"&response_type=image";
      }
      step(1);
    }


    function saveScreenshot(){
      window.open($("#responseImage").attr("src"), '_system');
    }

    function shareScreenshot(){
      alert("share");
    }
    function onBackKeyDown() {





      if(currentStep==0 || currentStep==1) {step(0); return;}
      if(currentStep==3) {step(0);$("#domain").val(""); defaultValues(); return; }
      if(currentStep==4) {step(1); return;}
      if(currentStep ==2){   cancelScreen=true;     step(0);       return;    }

    }
    function validURL(str) {
  var pattern = new RegExp('^(https?:\\/\\/)?'+ // protocol
    '((([a-z\\d]([a-z\\d-]*[a-z\\d])*)\\.)+[a-z]{2,}|'+ // domain name
    '((\\d{1,3}\\.){3}\\d{1,3}))'+ // OR ip (v4) address
    '(\\:\\d+)?(\\/[-a-z\\d%_.~+]*)*'+ // port and path
    '(\\?[;&a-z\\d%_.~+=-]*)?'+ // query string
    '(\\#[-a-z\\d_]*)?$','i'); // fragment locator
  return !!pattern.test(str);
}
var currentNameWebsite;
var currentStep=0;
var haveParams=false;
function emptyStep(){
  $("#firstStep").css("display","none");
  $("#secondStep").css("display","none");
  $("#fetching").css("display","none");
  $("#thirdStep").css("display","none");
  $("#fourStep").css("display","none");
}
    function step(id){

      currentStep=id; emptyStep();
       if(id==0)    $("#firstStep").fadeIn();
        if(id==1){
            var protocol; var domainOutProtocol;
            domain=$("#domain").val();
            searchProtocol=domain.indexOf("://");
            (searchProtocol != -1 )? domainOutProtocol=domain.substring( searchProtocol+3 ) : domainOutProtocol=domain;
            (searchProtocol != -1 )? protocol=domain.substring(0,searchProtocol+3 ) : protocol="http://";
            splitDomain=domainOutProtocol.split("/");
            theDomain=splitDomain[0];

            currentNameWebsite=protocol+domainOutProtocol;


            //alert(protocol + "<>" +domainOutProtocol);
            if(validURL(theDomain)!=false){
                $("#firstStep").fadeOut();
                $("#secondStep").fadeIn();
                (currentNameWebsite.length > 30) ? $("#nameWebsite").html("<a title='"+currentNameWebsite+"'  onclick=\"alert('"+currentNameWebsite+"');\">"+currentNameWebsite.substring(0,30)+"..</a>")                : $("#nameWebsite").html(currentNameWebsite);

            }else{
                alert("Please write a correct name of website");
                $("#firstStep").fadeIn();
            }
        }
        if(id==2){

          $("#fetching").fadeIn();

            $("#responseImage").attr("src","");
            $("#responseImage").css("display","none");
            startAnimation();
            $.post("https://internetespoder.com/apps/easyscreenshotswebsite/cdn/core.php",{site:currentNameWebsite, params:strParams}).done(function(data){
              //alert(data);
              dataImage=data;


                  $("#responseImage").attr("src",data);
                  setTimeout(function(){
                  if(!cancelScreen)    {
                      step(3);
                      endAnimation();
                      $("#responseImage").fadeIn();


//savebase64AsImageFile(folderpath,filename,myBase64,contentType);
saveFileTemp();

                      }else{
                          cancelScreen=false;
                      }
                     },5000);

                });

                }




        if(id==3){

          $("#thirdStep").fadeIn();
        }
        if(id==4){

          $("#fourStep").fadeIn();;
        }
    }
    function logoIn(){
        $(".fadeinLogo").animate({opacity:1},800,"linear",function(){
            logoOut();
        });
    }
    function logoOut(){
          $(".fadeinLogo").animate({opacity:0.8},200,"linear");
    }
      var intervalLoading;
    function startAnimation(){
      intervalLoading=setInterval(function(){
          logoIn();
      },1200);
    }

    function endAnimation(){
      clearInterval(intervalLoading);
        $(".fadeinLogo").animate({opacity:0.8},200,"linear");
    }

    startAnimation();
            setTimeout(function(){
              //Checking Net Connection
              // Register Activiy in DB
              // Validate images loaded

                $("#loadingPage").fadeOut();
                $("#contentStep").fadeIn();
                step(0);
                endAnimation();
            },2000);

            function saveFile2(){
              toDataURL($("#responseImage").attr("src"), function(dataUrl) {
              alert(dataUrl);
           })
            }
            function saveFile(){
              var fileName = 'myfile.txt';    // your file name
var data = '...';               // your data, could be useful JSON.stringify to convert an object to JSON string
window.resolveLocalFileSystemURL( cordova.file.externalRootDirectory, function( directoryEntry ) {
    directoryEntry.getFile(fileName, { create: true }, function( fileEntry ) {
        fileEntry.createWriter( function( fileWriter ) {
            fileWriter.onwriteend = function( result ) {
                console.log( 'done.' );
            };
            fileWriter.onerror = function( error ) {
                console.log( error );
            };
            fileWriter.write( data );
        }, function( error ) { console.log( error ); } );
    }, function( error ) { console.log( error ); } );
}, function( error ) { console.log( error ); } );
            }


            var dataImage="";
            function saveFileTemp(){
              var x=prompt("name file .jpg");
              var fileName = x;//'myfile.txt';    // your file name
var data = dataImage;//b64toBlob(dataImage, "image/jpeg")    ;           // your data, could be useful JSON.stringify to convert an object to JSON string
window.resolveLocalFileSystemURL( cordova.file.externalRootDirectory, function( directoryEntry ) {
    directoryEntry.getFile(fileName, { create: true }, function( fileEntry ) {
        fileEntry.createWriter( function( fileWriter ) {
            fileWriter.onwriteend = function( result ) {
                console.log( 'done.' );
               alert("writed");
            };
            fileWriter.onerror = function( error ) {
                console.log( error );
                alert(error);
            };
            fileWriter.write( data );
        }, function( error ) { alert(error); } );
    }, function( error ) { alert(error); } );
}, function( error ) { alert(error); } );
            }


            function isCanvasSupported(){
  var elem = document.createElement('canvas');
  alert( !!(elem.getContext && elem.getContext('2d')));
}

function toDataURL(url, callback) {
           var httpRequest = new XMLHttpRequest();
           httpRequest.onload = function() {
              var fileReader = new FileReader();
                 fileReader.onloadend = function() {
                    callback(fileReader.result);
                 }
                 fileReader.readAsDataURL(httpRequest.response);
           };
           httpRequest.open('GET', url);
           httpRequest.responseType = 'blob';
           httpRequest.send();
        }

        function b64toBlob(b64Data, contentType, sliceSize) {
                contentType = contentType || '';
                sliceSize = sliceSize || 512;

                var byteCharacters = atob(b64Data);
                var byteArrays = [];

                for (var offset = 0; offset < byteCharacters.length; offset += sliceSize) {
                    var slice = byteCharacters.slice(offset, offset + sliceSize);

                    var byteNumbers = new Array(slice.length);
                    for (var i = 0; i < slice.length; i++) {
                        byteNumbers[i] = slice.charCodeAt(i);
                    }

                    var byteArray = new Uint8Array(byteNumbers);

                    byteArrays.push(byteArray);
                }

              var blob = new Blob(byteArrays, {type: contentType});
              return blob;
        }

        function savebase64AsImageFile(folderpath,filename,content,contentType){
            // Convert the base64 string in a Blob
            var DataBlob = b64toBlob(content,contentType);

            console.log("Starting to write the file :3");

            window.resolveLocalFileSystemURL(folderpath, function(dir) {
                console.log("Access to the directory granted succesfully");
        		dir.getFile(filename, {create:true}, function(file) {
                    console.log("File created succesfully.");
                    file.createWriter(function(fileWriter) {
                        console.log("Writing content to file");
                        fileWriter.write(DataBlob);
                        alert("writed in root");
                    }, function(){
                        alert('Unable to save file in path '+ folderpath);
                    });
        		});
            });
        }


    </script>
    <script type="text/javascript">
        app.initialize();
    </script>

  </body>
</html>
